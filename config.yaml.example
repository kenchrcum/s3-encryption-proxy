listen_addr: ":8080"
log_level: "info"
# proxied_bucket: ""  # Optional: If set, the gateway will only proxy requests for this specific bucket
                      # Set via PROXIED_BUCKET env var

backend:
  endpoint: "https://s3.amazonaws.com"
  region: "us-east-1"
  access_key: ""  # Set via BACKEND_ACCESS_KEY env var
  secret_key: ""   # Set via BACKEND_SECRET_KEY env var
  provider: ""  # Optional: provider name for reference (any S3-compatible API endpoint works)
  use_ssl: true
  # filter_metadata_keys: []  # Optional: Comma-separated list of metadata keys to filter out
  #                           # Useful for S3 backends that reject certain metadata keys
  #                           # Set via BACKEND_FILTER_METADATA_KEYS env var
  # use_client_credentials: false  # Optional: If true, extract and use credentials from client requests
  #                                 # When enabled, the gateway will use the client's credentials for backend access,
  #                                 # respecting their access rights. REQUIRES credentials in every request.
  #                                 # Backend access_key and secret_key are NOT required when this is enabled.
  #                                 # 
  #                                 # SUPPORTED: Query parameters (AWSAccessKeyId, AWSSecretAccessKey in URL)
  #                                 # NOT SUPPORTED: AWS Signature V4 (Authorization header) - signature validation fails
  #                                 #   because the signature includes the Host header, and forwarding changes it.
  #                                 # 
  #                                 # If credentials cannot be extracted, the request will fail (no fallback).
  #                                 # Set via BACKEND_USE_CLIENT_CREDENTIALS env var

encryption:
  password: ""     # Set via ENCRYPTION_PASSWORD env var
  preferred_algorithm: "AES256-GCM"  # Options: AES256-GCM, ChaCha20-Poly1305
  supported_algorithms:
    - "AES256-GCM"
    - "ChaCha20-Poly1305"
  chunked_mode: true  # Enable chunked/streaming encryption (default: true)
  chunk_size: 65536   # Chunk size in bytes (default: 65536 = 64KB). Range: 16KB-1MB
  key_manager:
    enabled: false  # Set to true to enable key rotation/KMS mode (default: single password mode)
    provider: "cosmian"  # KMS provider: "cosmian" (currently supported), "aws", "vault" (planned for v1.0)
    dual_read_window: 1  # Number of previous key versions to try during rotation (default: 1)
    cosmian:
      # Cosmian KMIP endpoint (supports both binary and JSON protocols)
      # RECOMMENDED: JSON/HTTP endpoint (tested and verified)
      #   - Full URL format (recommended): "http://localhost:9998/kmip/2_1" or "https://kms.example.com/kmip/2_1"
      #   - Base URL format (also works): "http://localhost:9998" (path /kmip/2_1 is auto-appended)
      #   - No TLS client certificates required for HTTP (testing)
      #   - TLS certificates required for HTTPS (production)
      # ADVANCED: Binary KMIP endpoint (requires proper TLS/client certificates)
      #   - Use host:port format: "localhost:5696" or "kms.example.com:5696"
      #   - Requires proper TLS configuration (ca_cert, client_cert, client_key)
      #   - Not fully tested in CI - use with caution
      endpoint: ""  # Set via COSMIAN_KMS_ENDPOINT env var (recommended: "http://localhost:9998/kmip/2_1" or "http://localhost:9998")
      timeout: "10s"  # Set via COSMIAN_KMS_TIMEOUT env var (default: 5s)
      # Wrapping keys configuration - at least one key is required
      # Format: YAML list of key references with ID and version
      # For environment variables, use comma-separated format: "key1:1,key2:2"
      keys:
        # Example with single key:
        # - id: "wrapping-key-1"  # Key ID from Cosmian KMS (get from KMS UI)
        #   version: 1             # Version number for this key
        # Example with multiple keys for rotation:
        # - id: "wrapping-key-1"
        #   version: 1
        # - id: "wrapping-key-2"
        #   version: 2
      # TLS configuration (optional, for production deployments)
      # ca_cert: "/path/to/ca.pem"  # Set via COSMIAN_KMS_CA_CERT env var
      # client_cert: "/path/to/client.crt"  # Set via COSMIAN_KMS_CLIENT_CERT env var
      # client_key: "/path/to/client.key"  # Set via COSMIAN_KMS_CLIENT_KEY env var
      # insecure_skip_verify: false  # Set via COSMIAN_KMS_INSECURE_SKIP_VERIFY env var (for testing only)

compression:
  enabled: false
  min_size: 1024
  content_types:
    - "text/plain"
    - "application/json"
    - "application/xml"
  algorithm: "gzip"
  level: 6

server:
  read_timeout: "15s"
  write_timeout: "15s"
  idle_timeout: "60s"
  read_header_timeout: "10s"
  max_header_bytes: 1048576
  # disable_multipart_uploads: false  # Optional: Set to true to disable multipart uploads entirely
  #                                   # This ensures all uploaded data is encrypted, but prevents multipart uploads
  #                                   # Set via SERVER_DISABLE_MULTIPART_UPLOADS env var

tls:
  enabled: false
  cert_file: ""  # Set via TLS_CERT_FILE env var
  key_file: ""   # Set via TLS_KEY_FILE env var

rate_limit:
  enabled: false
  limit: 100     # Requests per window
  window: "60s"  # Time window for rate limiting

cache:
  enabled: false
  max_size: 104857600    # 100MB in bytes
  max_items: 1000
  default_ttl: "5m"       # 5 minutes

audit:
  enabled: false
  max_events: 10000       # Maximum events to keep in memory